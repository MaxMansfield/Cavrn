<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Cavrn AVR8 Library: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cavrn_banner_124x46.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cavrn AVR8 Library
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Sedimentary Olm</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;![Cavrn](http://i.imgur.com/jhAaUmd.png) </div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# An easy to use and extremely flexible library for AVR Microcontrollers, written in pure C.</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;###### Major Version: 0 (Sedimentary)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;###### Minor Version: 1.0  (Olm)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;###### Version: 0.1.0 (*Sedimentary Olm*)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;###### Working Modules: Uart</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;###### Modules in Work: SPI Nrf24</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;###### Future Modules: I2C W5100 SSD1306</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;###### Supported MCUs: ATmega328p, ATmega103</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;###### Coming Soon: ATtiny85</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;###### Cavrn is currently a work in progress. This readme may be terribly out of date due to that.</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Cavrn library is built on avr-libc, compiled with avr-gcc and meant to be easy to use while still retaining flexibility per mmcu for professional situations. Each available function (Uart,Spi,Nrf24) which I&#39;ll be calling a module has a static struct that can be treated as an object when performing its operations. Cavrn takes techniques found in the arduino library (like how Cavrn uses typedefs and defines to create more verbose types such as bool and byte, both of which mean a uint8_t but when used correctly your code becomes much more explicit) as well as borrows from multiple others across the internet (including the NRF24lo1 repo this was originally forked from) to combine them with good practices and solid compiler integration. </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;Cavrn uses static structs full of function pointers to represent each module an its capabilities.</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;A module is then called by the module name and then the function, similar to an object.</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;Ex.</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;#include &quot;cavrn/uart.h&quot;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;int main (void)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   /* initialize UART in full duplex */</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    Uart.init(ASYNC_MODE);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    /* only send/recieve  printable char when using Uart.txString and Uart.rxString() */</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    Uart.printableCharsOnly = false;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    /* global interrupts Off */</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    Cavrn.setInterrupts(OFF);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    /* enables global interrupts and enables Uart TX interrupts */</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    Uart.setTxInterrupt(ON);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    /* byte is defined as part of Cavrn check the docs for more. */</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    byte count = 0;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    while(1){</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;       char text[32];</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;       sprinf(text,&quot;Run number %d&quot;,count++);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;       Uart.txString(text);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;       Uart.txByte(&quot;A&quot;);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    return 0;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;## Documentation </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;Like the repo, the documentation is a work-in-progress so some pieces MAY be inaccurate, although it&#39;s unlikely. In most cases the documenation will be much more accurate than what you&#39;re reading right now.</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;To read the documentation go to</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;[http://maxmansfield.github.io/Cavrn/](http://maxmansfield.github.io/Cavrn/)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;Going to the modules page or the files page is the most helpful at the moment of writing this.</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;## Requirements</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;To compile Cavrn you will need the avr-gcc suite as well as avr-libc. To upload you will need avrdude and to view serial data you can install screen and type `make console` but for long term use I recommend minicom.</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;At the moment a board with an Atmega328p or Atmega103 is required, but this will change soon. If you have the interest, it would be very simple to add defines for a board that you own. Simply define each pin that will be used in the appropriate header file.</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;## Building Cavrn</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;At the moment there is not an install script to create a shared library file and install via a package manager, but I have a handy script for that which I need to modify just a bit for it to work with this.</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;For the time being here&#39;s the build process:</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;1. Download the repo and change `settings.inc` to fit your needs. (note: you don&#39;t need to change any other file like `cavrn_config.inc` or the `Makefile`). </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;2. Run `make -j 2` </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;3. The built objects and a static library file will be in the newly created `build/` directory</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;## Building Examples</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;Since the examples rely on the library being built, when you make the examples it will also build the library.</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;1. Run `make examples`</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;2. cd examples/Uart/Tx/ or any example directory</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;3. run `make` to build an example</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;## Using Cavrn</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;To use Cavrn include the source and objects or static library files in you project directory or link to them. At the moment this is not the easiest part of the process by any means but it has only been a few days, give it time and I&#39;ll have a killer install chain.</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;# UART</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;#### A library implementation for sending/recieving bytes or strings via UART pins. </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;### Configuration</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;Uart is able to take advantage of all modes given by an MCU. Just provide it during initialization.</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;*note: The AVR ATmega103 does not have available status control registers to determine half/full duplex so no mode is needed at initialization.*</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;Uart.init(ASYNC_MODE)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;or</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;Uart.init(SYNC_MODE)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;or</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;Uart.init(MSPI_MODE)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;Uart relies on a BAUD definition at compile time because many preprocessor directives rely on it; one benefit of doing it this way is that no large 32bit integers have to be used (ex. Baud of 115200) another is the assurance that your baud rate is what you would expect throughout the program and finally no compute time is wasted on arithmatic to calculate baud rates or `F_OSC` clock rates or even to separate high and low values for the USART Baud Rate Register because the preprocessor computes it.</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;To Define the Baud rate add -DBAUD=9600 or any other rate to the compilation. For most situations, simply fill in the provided `settings.inc` file. During the extent of your program you can change the BAUD by undefining BAUD and redefining it before reincluding the `&lt;util/setbaud.h&gt;` file. This sounds janky but the setbaud.h file is simply a collection of preprocessor directives which will only be present at compile time and infact avr-libc recommends this way.</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;Take this example to see how easy to use the Uart library is (and eventually all of Cavrn).</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;#include &quot;Cavrn/uart.h&quot;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;int main(void)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  Uart.init(ASYNC_MODE);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  Uart.txString(&quot;Device Initialized\n\r&quot;);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  while(1){</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    uint8_t recieved = Uart.rxByte();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    char text[128];</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    sprintf(text,&quot;Devices Recieved Data: %d\n\rAnalyzing...&quot;,recieved);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    Uart.txString(text);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  return 0;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;# SPI (Almost Operational)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;#### A simple and elegant peripheral communication library.</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;The SPI library takes a fairly straight forward and simple process even further by encapsulating functions in a data safe manner with high pointer usage for optimization but still gives you the flexibility that you would have from coding it by hand.</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;You can choose from the 4 clock polarity modes provided by Atmel.</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;![Table of SPI MODES 0-3](http://i.imgur.com/S5VM2XL.png)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;By initializing SPI with one of the four modes like so...</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;#include &quot;Cavrn/spi.h&quot;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;int main(void){</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  /* To assign as a master device */</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  Spi.init(MASTER,SPI_MODE0,F_OSC16);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  //or another way to assign as a master device (true is defined as part of Cavrn)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  Spi.init(true,SPI_MODE0,F_OSC16); </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  // or as a slave device</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  Spi.init(SLAVE,SPI_MODE2,F_OSC8); </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  // and the data order can be changed from MSB to LSB and back by using setDataOrder from Spi...</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  Spi.setDataOrder(MSB_ORDER);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  //Spi.setDataOrder(true) try using...HIGH,OUT,ON instead of true</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  // or for least significant bit</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  Spi.setDataOrder(LSB_ORDER);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  //Spi.setDataOrder(false);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  Spi.setInterrupts(true);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  //Spi.setInterrupts(ON);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  // To transfer via SPI</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  char letter_L = &#39;L&#39;;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  uint8_t recieved = Spi.transfer(letter_L);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  // To transfer large amounts</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  byte[128] text;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  byte[128] out = &quot;Hello World&quot;;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  Spi.multiTransfer(out,text,128);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  Spi.disable();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   return 0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;# NRF24 (Relies on SPI)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;#### Making wireless connectivity quick and painless.</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;This module enables the auto acknowledgement and auto retransmission features of the nrf24L01+ in static length payload mode. </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;These two features are basically the most important features of the nrf24L01+ modules. With this module, after you make a tranmission attempt, you&#39;ll know for sure wheter the slave device got your message properly or not with minimal MCU involvement. Also, nrf24L01+ chipsets automatically handle the retranmission of the same message if it they lost in transmission, up to o limited trials with adjustable delays in between attempts.</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;### Configuration</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;Configuration of the module is simple. Max retransmission count is set to 15 and delays between each retranmission is set to 1000 us. Also the CRC is enabled with 1byte length. Data rate is set to 1Mbps.</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;Via the config function, you can chose the channel and the payload length. Max payload length is 32. After the config function the module automatically goes to RX mode. Payload length and the RF channel values have to be consistent among the devices.</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   /* initializes hardware pins */</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   Nrf24.init();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   /* RF channel: #2 , payload length: 4 */</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   Nrf24.config(2,4)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;### Addressing</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;Address length is 5 bytes. You can configure the transmit and receive addresses as follows:</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   uint8_t rx_mac[5] = {0xE7,0xE7,0xE7,0xE7,0xE7};</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   uint8_t tx_mac[5] = {0xD7,0xD7,0xD7,0xD7,0xD7};</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   /* Set the module&#39;s own address */</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   Nrf24.rxAddr(rx_mac);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   /* Set the transmit address */</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   Nrf24.txAddr(tx_mac);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;### Transmit</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;Let&#39;s say the payload length is set to 4 and you have the following payload.</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   uint8_t data_array[4];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   data_array[0] = 0x00;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   data_array[1] = 0xAA;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   data_array[2] = 0x55;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   data_array[3] = 0xFF;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;The basic transmit function is the `Nrf24.txData()` function. The module automatically switches to the TX mode and power up if required.</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   /* Automatically goes to TX mode */</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   Nrf24.txData(data_array);       </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;After the `Nrf24.txData()`, you must wait for transmission to end. MCU can sleep or do another tasks during that period.</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   /* Wait for transmission to end */</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   while(Nrf24.isSending());</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;After the transmission end, optionally you can make analysis on the last transmission attempt.</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   uint8_t temp;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   /* Make analysis on last tranmission attempt */</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   temp = Nrf24.lastTxStatus();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   if(temp == NRF24_TRANSMISSON_OK)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   {                   </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;       Uart.txString(&quot;Tranmission went OK\r\n&quot;);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   else if(temp == NRF24_MESSAGE_LOST)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   {                   </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;       Uart.txString(&quot;Message is lost ...\r\n&quot;);   </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;       </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    /* Retranmission count indicates the tranmission quality */</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    temp = Nrf24.badTxCount();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    char msg[64];</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    sprintf(msg,&quot;Retranmission count: %d\r\n&quot;,temp);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    Uart.txString(msg);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; ~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;After the tranmission finishes, nrf24L01+ module stays in Standby mode. You can manually go back to RX mode:</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   /* Go back to RX mode ... */</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   Nrf24.powerRx();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; ~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;Or you can power down the module to lower the current consumption.</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    /* Power down the module */</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    Nrf24.powerDown(); </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;### Receive</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;This library doesn&#39;t use the IRQ pin of the nrf24L01+ (yet) , therefore you need to poll the `Nrf24.dataReady()` function periodically. Otherwise you might miss some packets. </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;Also, you need to be in RX mode in order to be able to receive messages.</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;`Nrf24.dataReady()` function returns non-zero only if a valid payload is awaiting in the RX fifo. `Nrf24.getData(uint8_t* buf)` function copies the received message into the given buffer. </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;~~~~~~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   uint8_t data_array[4];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   if(nNrf24.dataReady())</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;       Nrf24.rxData(data_array);       </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;~~~~~~~~~~~~~~~~~~~~</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;## References</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;This module is proudly and heavily based on the following libraries:</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;- https://github.com/aaronds/arduino-nrf24l01</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;- http://www.tinkerer.eu/AVRLib/nRF24L01</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 19 2015 17:02:52 for Cavrn AVR8 Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
